{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport * as Location from \"expo-location\";\nimport firebase from \"firebase\";\nimport \"firebase/firestore\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nvar CustomActions = function (_React$Component) {\n  _inherits(CustomActions, _React$Component);\n\n  var _super = _createSuper(CustomActions);\n\n  function CustomActions() {\n    var _this;\n\n    _classCallCheck(this, CustomActions);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _this.pickImage = function _callee() {\n      var _await$ImagePicker$re, status, result, imageUrl;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(ImagePicker.requestMediaLibraryPermissionsAsync());\n\n            case 2:\n              _await$ImagePicker$re = _context.sent;\n              status = _await$ImagePicker$re.status;\n              _context.prev = 4;\n\n              if (!(status === \"granted\")) {\n                _context.next = 14;\n                break;\n              }\n\n              _context.next = 8;\n              return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n                mediaTypes: ImagePicker.MediaTypeOptions.Images\n              }).catch(function (error) {\n                console.error(error);\n              }));\n\n            case 8:\n              result = _context.sent;\n\n              if (result.cancelled) {\n                _context.next = 14;\n                break;\n              }\n\n              _context.next = 12;\n              return _regeneratorRuntime.awrap(_this.uploadImage(result.uri));\n\n            case 12:\n              imageUrl = _context.sent;\n\n              _this.props.onSend({\n                image: imageUrl\n              });\n\n            case 14:\n              _context.next = 19;\n              break;\n\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](4);\n              console.error(_context.t0);\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[4, 16]], Promise);\n    };\n\n    _this.takePhoto = function _callee2() {\n      var _await$ImagePicker$re2, status, result, imageUrl;\n\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(ImagePicker.requestCameraPermissionsAsync());\n\n            case 2:\n              _await$ImagePicker$re2 = _context2.sent;\n              status = _await$ImagePicker$re2.status;\n              _context2.prev = 4;\n\n              if (!(status === \"granted\")) {\n                _context2.next = 14;\n                break;\n              }\n\n              _context2.next = 8;\n              return _regeneratorRuntime.awrap(ImagePicker.launchCameraAsync({\n                mediaTypes: ImagePicker.MediaTypeOptions.All\n              }).catch(function (error) {\n                console.error(error);\n              }));\n\n            case 8:\n              result = _context2.sent;\n\n              if (result.cancelled) {\n                _context2.next = 14;\n                break;\n              }\n\n              _context2.next = 12;\n              return _regeneratorRuntime.awrap(_this.uploadImage(result.uri));\n\n            case 12:\n              imageUrl = _context2.sent;\n\n              _this.props.onSend({\n                image: imageUrl\n              });\n\n            case 14:\n              _context2.next = 19;\n              break;\n\n            case 16:\n              _context2.prev = 16;\n              _context2.t0 = _context2[\"catch\"](4);\n              console.error(_context2.t0);\n\n            case 19:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, [[4, 16]], Promise);\n    };\n\n    _this.uploadImage = function _callee3(uri) {\n      var blob, imageNameBefore, imageName, ref, snapshot;\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(new Promise(function (resolve, reject) {\n                var xhr = new XMLHttpRequest();\n\n                xhr.onload = function () {\n                  resolve(xhr.response);\n                };\n\n                xhr.onerror = function (e) {\n                  console.log(e);\n                  reject(new TypeError(\"Network request failed\"));\n                };\n\n                xhr.responseType = \"blob\";\n                xhr.open(\"GET\", uri, true);\n                xhr.send(null);\n              }));\n\n            case 2:\n              blob = _context3.sent;\n              imageNameBefore = uri.split(\"/\");\n              imageName = imageNameBefore[imageNameBefore.length - 1];\n              ref = firebase.storage().ref().child(\"images/\" + imageName);\n              _context3.next = 8;\n              return _regeneratorRuntime.awrap(ref.put(blob));\n\n            case 8:\n              snapshot = _context3.sent;\n              blob.close();\n              _context3.next = 12;\n              return _regeneratorRuntime.awrap(snapshot.ref.getDownloadURL());\n\n            case 12:\n              return _context3.abrupt(\"return\", _context3.sent);\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.getLocation = function _callee4() {\n      var _await$Location$reque, status, result;\n\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(Location.requestForegroundPermissionsAsync());\n\n            case 2:\n              _await$Location$reque = _context4.sent;\n              status = _await$Location$reque.status;\n              _context4.prev = 4;\n\n              if (!(status === \"granted\")) {\n                _context4.next = 10;\n                break;\n              }\n\n              _context4.next = 8;\n              return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({}).catch(function (error) {\n                console.error(error);\n              }));\n\n            case 8:\n              result = _context4.sent;\n\n              if (result) {\n                _this.props.onSend({\n                  location: {\n                    longitude: result.coords.longitude,\n                    latitude: result.coords.latitude\n                  }\n                });\n              }\n\n            case 10:\n              _context4.next = 15;\n              break;\n\n            case 12:\n              _context4.prev = 12;\n              _context4.t0 = _context4[\"catch\"](4);\n              console.error(_context4.t0);\n\n            case 15:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, [[4, 12]], Promise);\n    };\n\n    _this.onActionPress = function () {\n      var options = [\"Choose From Library\", \"Take Picture\", \"Send Location\", \"Cancel\"];\n      var cancelButtonIndex = options.length - 1;\n\n      _this.context.actionSheet().showActionSheetWithOptions({\n        options: options,\n        cancelButtonIndex: cancelButtonIndex\n      }, function _callee5(buttonIndex) {\n        return _regeneratorRuntime.async(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.t0 = buttonIndex;\n                _context5.next = _context5.t0 === 0 ? 3 : _context5.t0 === 1 ? 5 : _context5.t0 === 2 ? 7 : 9;\n                break;\n\n              case 3:\n                console.log(\"user wants to pick an image\");\n                return _context5.abrupt(\"return\", _this.pickImage());\n\n              case 5:\n                console.log(\"user wants to take a photo\");\n                return _context5.abrupt(\"return\", _this.takePhoto());\n\n              case 7:\n                console.log(\"user wants to get their location\");\n                return _context5.abrupt(\"return\", _this.getLocation());\n\n              case 9:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(CustomActions, [{\n    key: \"render\",\n    value: function render() {\n      return _jsx(TouchableOpacity, {\n        accessible: true,\n        accessibilityLabel: \"More options\",\n        accessibilityHint: \"Let\\u2019s you choose to send an image or your geolocation.\",\n        style: [styles.container],\n        onPress: this.onActionPress,\n        children: _jsx(View, {\n          style: [styles.wrapper, this.props.wrapperStyle],\n          children: _jsx(Text, {\n            style: [styles.iconText, this.props.iconTextStyle],\n            children: \"+\"\n          })\n        })\n      });\n    }\n  }]);\n\n  return CustomActions;\n}(React.Component);\n\nexport { CustomActions as default };\nCustomActions.contextTypes = {\n  actionSheet: PropTypes.func\n};\nvar styles = StyleSheet.create({\n  container: {\n    width: 26,\n    height: 26,\n    marginLeft: 10,\n    marginBottom: 10\n  },\n  wrapper: {\n    borderRadius: 13,\n    borderColor: \"#b2b2b2\",\n    borderWidth: 2,\n    flex: 1\n  },\n  iconText: {\n    color: \"#b2b2b2\",\n    fontWeight: \"bold\",\n    fontSize: 16,\n    backgroundColor: \"transparent\",\n    textAlign: \"center\"\n  }\n});","map":{"version":3,"sources":["C:/Users/baile/Documents/hello-world/components/CustomAction.js"],"names":["React","PropTypes","ImagePicker","Location","firebase","CustomActions","pickImage","requestMediaLibraryPermissionsAsync","status","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","Images","catch","error","console","result","cancelled","uploadImage","uri","imageUrl","props","onSend","image","takePhoto","requestCameraPermissionsAsync","launchCameraAsync","All","Promise","resolve","reject","xhr","XMLHttpRequest","onload","response","onerror","e","log","TypeError","responseType","open","send","blob","imageNameBefore","split","imageName","length","ref","storage","child","put","snapshot","close","getDownloadURL","getLocation","requestForegroundPermissionsAsync","getCurrentPositionAsync","location","longitude","coords","latitude","onActionPress","options","cancelButtonIndex","context","actionSheet","showActionSheetWithOptions","buttonIndex","styles","container","wrapper","wrapperStyle","iconText","iconTextStyle","Component","contextTypes","func","StyleSheet","create","width","height","marginLeft","marginBottom","borderRadius","borderColor","borderWidth","flex","color","fontWeight","fontSize","backgroundColor","textAlign"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { TouchableOpacity, View, Text, StyleSheet } from \"react-native\";\r\nimport * as ImagePicker from \"expo-image-picker\";\r\nimport * as Location from \"expo-location\";\r\nimport firebase from \"firebase\";\r\nimport \"firebase/firestore\";\r\n\r\n// component for user actions (the '+' button) on message composer\r\nexport default class CustomActions extends React.Component {\r\n  // choose an image from device's gallery to send\r\n  pickImage = async () => {\r\n    // permission to access the user device's gallery\r\n    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();\r\n    try {\r\n      if (status === \"granted\") {\r\n        let result = await ImagePicker.launchImageLibraryAsync({\r\n          mediaTypes: ImagePicker.MediaTypeOptions.Images,\r\n        }).catch((error) => {\r\n          console.error(error);\r\n        });\r\n        if (!result.cancelled) {\r\n          const imageUrl = await this.uploadImage(result.uri);\r\n          this.props.onSend({ image: imageUrl });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  // Take a photo with the device's camera to send\r\n  takePhoto = async () => {\r\n    // permission to access user camera\r\n    const { status } = await ImagePicker.requestCameraPermissionsAsync();\r\n    try {\r\n      if (status === \"granted\") {\r\n        let result = await ImagePicker.launchCameraAsync({\r\n          mediaTypes: ImagePicker.MediaTypeOptions.All,\r\n        }).catch((error) => {\r\n          console.error(error);\r\n        });\r\n        if (!result.cancelled) {\r\n          const imageUrl = await this.uploadImage(result.uri);\r\n          this.props.onSend({ image: imageUrl });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  // Upload an image to Firestore\r\n  uploadImage = async (uri) => {\r\n    const blob = await new Promise((resolve, reject) => {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.onload = function () {\r\n        resolve(xhr.response);\r\n      };\r\n      xhr.onerror = function (e) {\r\n        console.log(e);\r\n        reject(new TypeError(\"Network request failed\"));\r\n      };\r\n      xhr.responseType = \"blob\";\r\n      xhr.open(\"GET\", uri, true);\r\n      xhr.send(null);\r\n    });\r\n\r\n    const imageNameBefore = uri.split(\"/\");\r\n    const imageName = imageNameBefore[imageNameBefore.length - 1];\r\n\r\n    const ref = firebase.storage().ref().child(`images/${imageName}`);\r\n\r\n    const snapshot = await ref.put(blob);\r\n\r\n    blob.close();\r\n\r\n    return await snapshot.ref.getDownloadURL();\r\n  };\r\n\r\n  // Access and send the user's location\r\n  getLocation = async () => {\r\n    // permission to access user location while the app is in the foreground\r\n    const { status } = await Location.requestForegroundPermissionsAsync();\r\n    try {\r\n      if (status === \"granted\") {\r\n        let result = await Location.getCurrentPositionAsync({}).catch(\r\n          (error) => {\r\n            console.error(error);\r\n          }\r\n        );\r\n        // Send latitude and longitude to locate the position on the map\r\n        if (result) {\r\n          this.props.onSend({\r\n            location: {\r\n              longitude: result.coords.longitude,\r\n              latitude: result.coords.latitude,\r\n            },\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  // Handling all communication features\r\n  onActionPress = () => {\r\n    const options = [\r\n      \"Choose From Library\",\r\n      \"Take Picture\",\r\n      \"Send Location\",\r\n      \"Cancel\",\r\n    ];\r\n    const cancelButtonIndex = options.length - 1;\r\n    this.context.actionSheet().showActionSheetWithOptions(\r\n      {\r\n        options,\r\n        cancelButtonIndex,\r\n      },\r\n      async (buttonIndex) => {\r\n        switch (buttonIndex) {\r\n          case 0:\r\n            console.log(\"user wants to pick an image\");\r\n            return this.pickImage();\r\n          case 1:\r\n            console.log(\"user wants to take a photo\");\r\n            return this.takePhoto();\r\n          case 2:\r\n            console.log(\"user wants to get their location\");\r\n            return this.getLocation();\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <TouchableOpacity\r\n        accessible={true}\r\n        accessibilityLabel=\"More options\"\r\n        accessibilityHint=\"Let’s you choose to send an image or your geolocation.\"\r\n        style={[styles.container]}\r\n        onPress={this.onActionPress}\r\n      >\r\n        <View style={[styles.wrapper, this.props.wrapperStyle]}>\r\n          <Text style={[styles.iconText, this.props.iconTextStyle]}>+</Text>\r\n        </View>\r\n      </TouchableOpacity>\r\n    );\r\n  }\r\n}\r\n\r\nCustomActions.contextTypes = {\r\n  actionSheet: PropTypes.func,\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    width: 26,\r\n    height: 26,\r\n    marginLeft: 10,\r\n    marginBottom: 10,\r\n  },\r\n  wrapper: {\r\n    borderRadius: 13,\r\n    borderColor: \"#b2b2b2\",\r\n    borderWidth: 2,\r\n    flex: 1,\r\n  },\r\n  iconText: {\r\n    color: \"#b2b2b2\",\r\n    fontWeight: \"bold\",\r\n    fontSize: 16,\r\n    backgroundColor: \"transparent\",\r\n    textAlign: \"center\",\r\n  },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}